---
output: github_document
# bibliography: docs/refs.bib
---
<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
here::i_am("README.Rmd")
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  echo = FALSE
)
```

---

Overview
--------

This repository houses the analytical pipeline to support the project, *Defining foraging hotspots of finfish and sharks in the New York Bight: Linking trophic dynamics with spatiotemporal trends in species distributions*. 

### Purpose

This pipeline is used to summarise data of trawl species data, pull environmental forecasts and backcasts of regional environmental variables, fit species and community models of the biological community, and forecast species biomasses/abundance to predict future sampling. The general structure of the pipeline is shown below.

```{r pipeline-fig, out.width = '70%', fig.cap = "General schematic of the analytical pipeline to predict species biomasses.", fig.align='center'}

knitr::include_graphics(path = here("docs/model-pres_June2025.png"))
```

### Repository structure

The repository is structured to keep the workflow organized. To do so, it uses the ['here' package](https://here.r-lib.org/) to navigate the file structure across users. The package can be installed from CRAN using `install.pacakges('here')`.

The main repository structure contains the folders:

- code: This contains all the scripts to load and clean the biological and environmental data.

- data: This folder holds derived data output from functions. The raw trawl data is stored on a local Access database named, `Nearshore Survey.accdb`. This file must be placed in a local folder in the project root directory called, `ignore`. The `ignore` folder should be added to the `.gitignore` file to avoid corrupting the database during Git procedures. The `init.R` file contains a procedure to check that the file structure is correct.

- docs: This folder houses project documents and output reports to summarise models and forecasts

- ignore: This is a hidden local folder that houses the Access database. This should be included in the local project `.gitignore` so must be created by each user. See above for initiation checks in the `init.R` script.

### Database access

Once the database is correctly stored locally, access to the database is managed by the [RODBC package](https://cran.r-project.org/web/packages/RODBC/index.html). This can be downloaded from CRAN using `install.packages("RODBC")`. 

The connection to the database is set using

```{r db-conn, echo = TRUE, eval=FALSE}
db <- odbcConnectAccess2007(here("ignore/Nearshore Survey.accdb"))
```

and all the available database tables with

```{r db-tables, echo = TRUE, eval=FALSE}
sqlTables(db)
```

```{r db-tables-view, echo=FALSE}
head(sqlTables(db),5) %>% dplyr::select(TABLE_NAME, TABLE_TYPE)
```

